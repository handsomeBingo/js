<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>多级菜单</title>
    <style>
        *{
            margin:0;
            padding:0;
            list-style: none;
        }
        .menu{
            width:300px;
            margin:30px auto;
            padding:10px;
            background: -webkit-linear-gradient(left top,lightblue,deeppink);
        }
        .menu li{
            line-height: 30px;
            position: relative;
        }
        .menu li em{
            position: absolute;
            top:7px;
            display: block;
            width:16px;
            height:16px;
            background: url("icon.png") no-repeat -59px -28px;
            font-family: "Microsoft Yahei", "΢���ź�", "Arial";
            color: #333;
            cursor: pointer;
        }
        .menu li em.open{
            background-position: -42px -28px;
        }
        .menu li span{
            display: inline-block;
            padding-left: 18px;
            -webkit-user-select: none;
        }
        ul{
            display: none;
        }
        .first{
            display: block;
        }
        .second{
            margin-left: 20px;
        }
        .third{
            margin-left: 40px;
        }
        .forth{
            margin-left: 60px;
        }
    </style>
</head>
<body>
<ul class="menu first">
    <li><span>第一级第一个</span></li>
    <li>
        <em></em><span>第一级第二个</span>
        <ul class="second">
            <li><span>第二级第一个</span></li>
            <ul class="third">
                <li><span>第三级第一个</span></li>
                <ul class="forth">
                    <li><span>第四级第一个</span></li>
                </ul>

            </ul>
        </ul>
    </li>
</ul>
</body>
<script src="utils20160916.js" charset="UTF-8"></script>
<script charset="utf-8">
   //先处理可以点击的span的cursor样式，只有span的上一个元素哥哥节点是em的才能加这个样式
    var menu=utils20160916.getElesByClass("menu")[0];
    var spans=menu.getElementsByTagName("span");
    for(var i=0;i<spans.length;i++){
        var cur=spans[i];
        var pre=utils20160916.prev(cur);
        if(pre&&pre.nodeName.toLowerCase()=="em"){
            //如果上一个哥哥存在，且元素哥哥的标签名是em才能给span加小手样式
            utils20160916.css(cur,"cursor","pointer");
        }
    }
    //把事件委托给最外层的menu：使用委托的时候离不开事件源
    menu.onclick=function(e){
        e=e||window.event;
        e.target= e.target|| e.srcElement;
        var reg=/(em)|(span)/i;
        if(reg.test(e.target.nodeName)){
            //如果通过验证时em或者span
            //但是符合条件的span不一定都是能打开的span
          //首先获取e.target的父节点，如果这个li存在一个ul的孩子，才是我们需要的事件源
            var parent= e.target.parentNode;
            var fistEm=utils20160916.children(parent,"em")[0];//获取第一个em，如果考虑节省性能，可以把em瞎子if判断中
            var firstUl=utils20160916.children(parent,"ul")[0];//因为有的l下没有ul，所以存在一个空数组的情况，如果是空数组，索引为0的为undefined，所以可以作为后面判断的依据
            if(firstUl){
                //如果代码运行至此的时候，说明li中存在一个ul，即可以打卡
                //以下即为实现多级菜单开合的代码
                //如果firstUl现在的样式，如果是block，娜美设置成none，否则设置成block
                var isBlock=utils20160916.css(firstUl,"display")=="block";
                if(isBlock){
                    var allUls=parent.getElementsByTagName("ul");
                    var allEms=parent.getElementsByTagName("em");
                    console.log(allEms);
                    for(var i=0;i<allUls.length;i++){
                        utils20160916.css(allUls[i],"display","none");
                        allEms[i].className="";
                    }
                }else{
                    utils20160916.css(firstUl,"display","block");
                    utils20160916.addClass(fistEm,"open")
                }
            }


        }
    }



</script>
</html>