<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>多级菜单</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            list-style: none;

        }
        .menu {
            width: 300px;
            margin: 30px auto;
            padding: 10px;
            background: -webkit-linear-gradient(left top, lightblue, deeppink);

        }
        .menu li {
            /*li不能写高度，因为li中不知道还有多少级元素，所以高度让其中元素自动撑开*/
            line-height: 30px;
            position: relative;
        }

        .menu li em {
            position: absolute;
            top: 7px;
            display: block;
            width: 16px;
            height: 16px;
            background: url("icon.png") no-repeat -59px -28px;
            font-family: "Microsoft YaHei";
            color: #333;
            cursor: pointer;
        }

        .menu li em.open {
            background-position: -42px -28px;
        }

        .menu li span {
            display: inline-block;
            padding-left: 18px;
            -webkit-user-select: none;
        }

        ul {
            display: none;
        }

        .first {
            display: block;
        }

        .second {
            margin-left: 20px;
        }

        .third {
            margin-left: 40px;
        }

        .forth {
            margin-left: 60px;
        }

    </style>
</head>
<body>
<ul id="" class="menu first">
    <li>
        <em></em><span>第一级第一个</span>
        <ul class="second">
            <li><span>第二级第一个</span></li>
            <li>
                <em></em><span>第二级第二个</span>
                <ul class="third">
                    <li>
                        <span>第三级第一个</span>
                    </li>
                    <li>
                        <em></em><span>第三级第二个</span>
                        <ul class="forth">
                            <li>
                                <em></em><span>第四级第一个</span>
                            </li>
                            <li>
                                <span>第四级第二个</span>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
    </li>
    <li><span>第一级第二个</span></li>
</ul>
</body>
<script src="utils20160916.js"></script>
<script>
    var menu = utils.getElesByClass("menu")[0];
    var spans = menu.getElementsByTagName("span");
    for (var i = 0; i < spans.length; i++) {
        var cur = spans[i];
        var pre = utils.prev(cur);
        if (pre && pre.nodeName.toLocaleLowerCase() == "em") {
            utils.css(cur, "cursor", "pointer");
        }
    }
    menu.onclick = function (e) {
        e = e || window.event;
        e.target = e.target || e.srcElement;
        var reg = /(em)|(span)/i;
        if (reg.test(e.target.nodeName)) {
            var parent = e.target.parentNode;
            var firstEm = utils.children(parent, "em")[0];
            var firstUl = utils.children(parent, "ul")[0];
            if (firstUl) {
                console.log(firstEm);
                var isBlock = utils.css(firstUl, "display") === "block";
                if (isBlock) {
                    var allUls = parent.getElementsByTagName("ul");
                    var allEms = parent.getElementsByTagName("em");
                    console.log(allUls);
                    for (var i = 0; i < allUls.length; i++) {
                        utils.css(allUls[i], "display", "none");
                        allEms[i].className = "";
                    }
                }else {
                    utils.css(firstUl, "display", "block");
                    utils.addClass(firstEm, "open");
                }
            }

        }
    }
</script>
</html>