<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>多级菜单</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            list-style: none;

        }

        .menu {
            width: 300px;
            margin: 30px auto;
            padding: 10px;
            background: -webkit-linear-gradient(left top, lightblue, deeppink);

        }

        .menu li {
            /*li不能写高度，因为li中不知道还有多少级元素，所以高度让其中元素自动撑开*/
            line-height: 30px;
            position: relative;
        }

        .menu li em {
            position: absolute;
            top: 7px;
            display: block;
            width: 16px;
            height: 16px;
            background: url("icon.png") no-repeat -59px -28px;
            font-family: "Microsoft YaHei";
            color: #333;
            cursor: pointer;
        }

        .menu li em.open {
            background-position: -42px -28px;
        }

        .menu li span {
            display: inline-block;
            padding-left: 18px;
            -webkit-user-select: none;
        }

        ul {
            display: none;
        }

        .first {
            display: block;
        }

        .second {
            margin-left: 20px;
        }

        .third {
            margin-left: 40px;
        }

        .forth {
            margin-left: 60px;
        }

    </style>
</head>
<body>
<ul id="" class="menu first">
    <li>
        <em></em><span>第一级第一个</span>
        <ul class="second">
            <li><span>第二级第一个</span></li>
            <li>
                <em></em><span>第二级第二个</span>
                <ul class="third">
                    <li>
                        <span>第三级第一个</span>
                    </li>
                    <li>
                        <em></em><span>第三级第二个</span>
                        <ul class="forth">
                            <li>
                                <em></em><span>第四级第一个</span>
                            </li>
                            <li>
                                <span>第四级第二个</span>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
    </li>
    <li><span>第一级第二个</span></li>
</ul>
</body>
<script src="utils20160916.js"></script>
<script>
    //先处理可以点击的span的cursor样式，只有span的上一个元素哥哥节点是em的才能加这个样式
    var menu = utils.getElesByClass("menu")[0];
    var spans = menu.getElementsByTagName("span");
    for (var i = 0; i < spans.length; i++) {
        var cur = spans[i];
        var pre = utils.prev(cur);
        if (pre && pre.nodeName.toLocaleLowerCase() == "em") {
            //如果上一个元素哥哥存在，且元素哥哥的标签名是em才能给该span加小手的样式
            utils.css(cur, "cursor", "pointer");
        }
    }
    //把事件委托给最外层的menu：使用委托的时候离不开事件源
    menu.onclick = function (e) {
        e = e || window.event;
        e.target = e.target || e.srcElement;
        //判断点击是否来源于em或者span
        var reg=/(em)|(span)/i;//i是或略大小写
        if(reg.test(e.target.nodeName)){
            //如果验证通过是em或者span
            //但是符合条件的span不一定是能打开的span，
            //首先获取e.target父节点，如果这个li存在一个ul的孩子，才是我们需要的事件源
            var parent= e.target.parentNode;
            var firstEm=utils.children(parent,"em")[0];//获取第一个em，如果考虑节省性能，可以把em写在if判断中
            var firstUl=utils.children(parent,"ul")[0];//存在获取不到的情况
            if(firstUl){//如果进入到这个条件中说明存在ul
                //从这里的代码才是真正的逻辑，以上的均是在判断

                //如果firstUl现在的样式，如果是block那么久设置成none，否则设置成block
                var isBlock=utils.css(firstUl,"display")==="block";//设置变量纪录一个条件的返回结果，即纪录一个布尔值
                if(isBlock){
                   /* utils.css(firstUl,"display","none");
                    utils.removeClass(firstEm,"open");*/
                    //把当前所有ul或者子级ul，em或者子级里的em的全部都恢复成默认样式
                    var allUls=parent.getElementsByTagName("ul");
                    console.log(allUls);
                    var allEms=parent.getElementsByTagName("em");
                    for(var i=0;i<allUls.length;i++){//ul和em个数相等，所以一个循环就搞定了
                        utils.css(allUls[i],"display","none");
                        allEms[i].className="";
                    }
                }else {
                    utils.css(firstUl,"display","block");
                    //别忘记给em设置成减号
                    utils.addClass(firstEm,"open");
                }
            }
        }
    }


</script>
</html>