<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>无标题文档</title>
</head>

<body>
</body>
</html>
<script>

//1.在bind里面已经做了避免重复的判断了，为什么还要在on里再做一次这样的判断。
	//bind是“真”绑定，是把fn的变形绑定到系统的事件上，这是为避免在真绑定上有重复绑定的情况出现，而做的判断。
	//那为什么在bind里也有一个数组，也要把fn变形的方法保存到这个数组里呢？
	//主要是为了unbind里移除绑定的时候，可以找到它的引用
	//通过这个数组，也可以实现：判断fn（的变形）是否被重复的绑定过
	//而on是“假”绑定。这种“绑定”是把fn保存到自己定义的数组里，为了避免在数组里出现重复项而做的判断
//2.
function bind(ele,eventType,fn){
	if(ele.addEventListener){
		ele.addEventListener(eventType,fn);
		return ;
		}
		if(!ele["mybind"+eventType]){
			ele["mybind"+eventType]=[];
			}
		var a=ele["mybind"+eventType];
		var temp=function(){
			fn.call(ele);
			}
		
		for(var i=0;i<a.length;i++){
			if(a[i].origin==fn)
			return;
			}
		a.push(temp);
		temp.origin=fn;
		//已经把temp存到数组a里了，再去改变temp，怎么能影响数组里的那个已经保存进去的方法呢
		ele.attachEvent("on"+eventType,temp);
	
	}
	function unbind(ele,eventType,fn){
		if(ele.removeEventListener){
			ele.removerEventListener(eventType,fn,false);
			return;
		}
		var a = ele["mybind"+eventType];
		for(var i = 0; i<a.length;i++){
			var cur = a[i];
			if(cur.origin===fn){
				a.splice(i,1);
				i--;
				ele.detachEvent('on'+eventType,cur);
				break;
				}
			}
		
	}
	
	on(ele,"click",fn);
	//
	function on(ele,eventType,fn){
		if(ele.addEventListener){
			
		}
		
		if(ele["myEvent"+eventType]){
			ele["myEvent"+eventType] = [];
			
			}
		var a = ele["myEvent"+eventType];
		for(var i=0;i<a.length;i++){
			if(a[i] == fn){
				return;
				}
			}
			a.push(fn);	
			bind(ele,type,run);	
		}
		function off(ele,eventType,fn){
			var a=ele["myevent"+eventType];
			for(var i=0;i<a.length;i++){
				if(a[i]==fn){
					a[i]=null;
					break;
					}
				}
			}
	fn(3);
	function run(e){
		//3.run方法在原来上课的时候有一个参数e，现在为什么没有了呢？
		//即使是标准浏览器，这个事件对象e是从那儿来的呢，是怎么传进来的呢？
		
		//当事件触发的时候，浏览器是如何执行绑定在事件上的方法的
		//浏览器是如何封装一个事件对象，并且当实参传给事件触发的方法
		//这些东西就是事件的原理
		var e = e||window.event;
		var a = this['myEvent'+e.type];
		for(var i = 0; i < a.length; i++){
			if(typeof a[i] == 'function'){
				a[i].call(this,e);
			}else{
				a.splice(i,1);
				i--;
			}
		}
	}
</script>
