<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>弹性势能动画</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: darkgray;
        }

        .box {
            width: 100px;
            height: 100px;
            background: green;
            position: absolute;
            top: 100px;
            left: 200px;
            cursor: move;
            z-index: 0;
        }

        .box img {
            width: 100%;
            height: 100%;
            border: none;
            vertical-align: top;
        }

        #box2 {
            left: 200px;
            top: 200px;
        }

    </style>
</head>
<body>
<div class="box" id="box"><img src="image123/1.png" alt=""></div>
<div class="box" id="box1"><img src="image123/2.png" alt=""></div>
<div class="box" id="box2"><img src="image123/2.png" alt=""></div>
</body>
<script src="event_end.js" charset="UTF-8"></script>
<script charset="UTF-8">
    var box = document.getElementById("box");
    var box1 = document.getElementById("box1");
    var minL = 0;
    var minT = 0;
    var n = 0;
    var maxL = (document.documentElement.clientWidth || document.body.clientWidth) - box.offsetWidth;
    var maxT = (document.documentElement.clientHeight || document.body.clientHeight) - box.offsetHeight;

    function down(e) {
        e = e || window.event;
        this["x"] = e.pageX;
        this["y"] = e.pageY;
        this["L"] = this.offsetLeft;
        this["T"] = this.offsetTop;
        var that = this;
        this.Move = function (e) {
            move.call(that, e);
        }
        this.Up = function (e) {
            up.call(that, e);
        }
        on(document, "mousemove", this.Move);
        on(document, "mouseup", this.Up);
        window.clearInterval(this.flyTimer);
        window.clearInterval(this.dropTimer);
        var oImg = document.getElementsByTagName("img");


        e.preventDefault();

        this.style.zIndex = ++n;
    }

    function move(e) {

        var curL = e.pageX - this["x"] + this["L"];
        var curT = e.pageY - this["y"] + this["T"];
        curL=curL < minL ? minL : curL > maxL ? maxL : curL;
        curT=curT < minT ? minT : curT > maxT ? maxT : curT;
        this.style.left = curL + "px";
        this.style.top = curT + "px";
        if (!this.pre) {
            this.pre = this.offsetLeft;
        } else {
            this.flySpeed = this.offsetLeft - this.pre;
            this.pre = this.offsetLeft;
        }
    }

    function up(e) {
        console.log(1);
        off(document, "mousemove", this.Move);
        off(document, "mouseup", this.Up);
        fly.call(this);
        drop.call(this);
    }

    function processThis(fn, obj) {
        return function (e) {
            fn.call(obj, e);
        }
    }

    on(box, "mousedown", down);
    on(box1, "mousedown", down);

    //水平运动

    function fly() {
     //debugger;
     if (Math.abs(speedFly) < .5) {
     window.clearInterval(this.flyTimer);
     }
     var that = this;
     var speedFly = this.flySpeed;
     this.flyTimer = window.setInterval(function () {
     speedFly *= 0.98;
     var curL = that.offsetLeft + speedFly;
     if (curL > maxL) {
     speedFly *= -1;
     } else if (curL < minL) {
     speedFly *= -1;
     }
     that.style.left = curL + "px";
     }, 17)
     }
    function drop(){
        var that=this;
        var speedDrop=9.8;
        var flag=0;
        that.dropTimer=window.setInterval(function(){
            if(flag>1){
                window.clearInterval(that.dropTimer);
                return;
            }
            speedDrop*=0.98;
            speedDrop+=10;
            var curT=that.offsetTop+speedDrop;
            if(curT>maxT){
                speedDrop*=-1;
                flag++;
            }else{
                flag=0;
            }
            that.style.top=curT+"px";



        },17)
    }


</script>
</html>